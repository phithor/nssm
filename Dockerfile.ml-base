# Shared ML base image (includes PyTorch and Transformers)
FROM nssm-base:latest

# Copy Poetry files and install ML dependencies (PyTorch, Transformers)
COPY pyproject.nlp.toml pyproject.toml
COPY poetry.nlp.lock poetry.lock
RUN poetry config virtualenvs.create false \
    && poetry install --only=main --no-root

# Set environment variables for ML
ENV PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:128
ENV TOKENIZERS_PARALLELISM=false
